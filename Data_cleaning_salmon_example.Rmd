---
title: "salmon_example for data cleaning practice"
author: "Ginny Eckert"
date: "11/6/2019"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
library(tidyverse)
```

To use functions from packages that conflict
package_name::function_name(...)
obj <- stats::filter(x)

# Read and Clean Data

```{r}
catch_original <- read.csv(url("https://knb.ecoinformatics.org/knb/d1/mn/v2/object/df35b.302.1", method = "libcurl"),
                    stringsAsFactors = FALSE)
head(catch_original)
```

Pipe operator shortcut is command-shift-M %>% 

Remove 'all' column and 'notes' column because we don't need them.
Create a new dataset

```{r}
catch_data <- catch_original %>% 
  #select(Region, Year, Chinook, Sockeye, Coho, Pink, Chum)
  select(-All, -notesRegCode) #drops instead of selecting; selecting could reorder;
```

```{r}
summary(catch_data)
```

# Fix Chinook character designation
Use 'mutate' to fix Chinook column

```{r}
catch_clean <- catch_data %>% 
  mutate(Chinook = ifelse(Chinook=="I", 1, Chinook)) %>% 
  mutate(Chinook =as.numeric(Chinook))

summary(catch_clean)
```

Used the following code to identify the one value that was non-numeric and then went back and fixed above, now commented it out so it doesn't do anything

```{r}
#i <- which(is.na(catch_clean$Chinook))
#i
```

```{r}
#catch_original[i,]
```


# Reshape Data

```{r}
catch_long <- catch_clean %>% 
  pivot_longer(cols = -c(Region, Year), names_to = "Species", values_to = "Count")
```

```{r}
catch_wide <- catch_long %>% 
  pivot_wider(names_from = Year,
              values_from = Count)
```

'rename' count column to 'catch_thousands'

```{r}
catch_long <- catch_long %>% 
  rename(catch_thousands = Count) %>% 
  mutate(catch = catch_thousands * 1000)
```

# Summarize Data

```{r}
mean_region <- catch_long %>% 
  group_by(Region, Species) %>% 
  summarize(catch_mean = mean(catch),num_obs = n())
```

```{r}
total <- catch_long %>% 
  group_by(Species) %>% 
  summarize(catch_total = sum(catch)) %>% 
  arrange(desc(catch_total))
```

```{r}
total_species_pre1900 <- catch_long %>% 
  filter(Year <1900) %>% 
  group_by(Species) %>% 
  summarize(catch_total = sum(catch)) %>% 
  arrange(desc(catch_total))
```

# Join to Region Table

```{r}
region_defs <- read.csv(url("https://knb.ecoinformatics.org/knb/d1/mn/v2/object/df35b.303.1",
                            method = "libcurl"),
                        stringsAsFactors = FALSE) %>% 
    select(code, mgmtArea)
```

```{r}
catch_joined <- left_join(catch_long, region_defs, by = c("Region" = "code"))
```

# Separate and Unite

```{r}
site_code <- data.frame(site = c("HAW-1", "HAW-2", "HAW-3", "OAH-1", "MAI-1"), stringsAsFactors = F)
```

separate island and site number using 'separate'

```{r}
site_code_split <- site_code %>% 
  separate(site, into = c("island", "site_num"), sep = "-")
site_code_split
```

```{r}
united <- site_code_split %>% 
 unite(col=site_code, island, site_num, sep = "-")
 
united
```

Note to self:  practice using trimws